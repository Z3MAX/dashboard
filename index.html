<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Cart√£o Corporativo Technology</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: 1.2em;
            color: #7f8c8d;
        }

        .file-upload {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .file-upload h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .file-input-group {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .file-input {
            padding: 10px;
            border: 2px dashed #3498db;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .process-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .process-btn:hover {
            background: #2980b9;
        }

        .process-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .metric strong {
            color: #2c3e50;
        }

        .metric .value {
            color: #27ae60;
            font-weight: bold;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .chart-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4em;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .transactions-table {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #34495e;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .filter-controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .filter-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        select, input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
        }

        .total-section {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .total-section h2 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .total-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .total-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .total-item h4 {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .total-item .amount {
            font-size: 1.5em;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
        }

        .hidden {
            display: none;
        }

        .error {
            color: #e74c3c;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .success {
            color: #155724;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Dashboard Cart√£o Corporativo Technology</h1>
            <p>An√°lise Completa dos Gastos Corporativos</p>
        </div>

        <div class="file-upload">
            <h3>üìÇ Carregar Arquivos Excel</h3>
            <p>Selecione os arquivos de cart√£o corporativo para an√°lise</p>
            <div class="file-input-group">
                <div>
                    <label for="maioFile">Arquivo Maio/Junho:</label>
                    <input type="file" id="maioFile" class="file-input" accept=".xlsx,.xls">
                </div>
                <div>
                    <label for="julhoFile">Arquivo Julho:</label>
                    <input type="file" id="julhoFile" class="file-input" accept=".xlsx,.xls">
                </div>
                <button id="processBtn" class="process-btn" disabled>üìä Processar Dados</button>
            </div>
            <div id="uploadStatus"></div>
        </div>

        <div id="dashboardContent" class="hidden">
            <div class="total-section">
                <h2>üìä Resumo Executivo</h2>
                <div class="total-grid">
                    <div class="total-item">
                        <h4>Total de Transa√ß√µes</h4>
                        <div class="amount" id="total-transactions">-</div>
                    </div>
                    <div class="total-item">
                        <h4>Total em USD</h4>
                        <div class="amount" id="total-usd">-</div>
                    </div>
                    <div class="total-item">
                        <h4>Total em BRL</h4>
                        <div class="amount" id="total-brl">-</div>
                    </div>
                    <div class="total-item">
                        <h4>Ticket M√©dio</h4>
                        <div class="amount" id="avg-ticket">-</div>
                    </div>
                </div>
            </div>

            <div class="summary-cards">
                <div class="card">
                    <h3>üìÖ Maio 2025</h3>
                    <div class="metric">
                        <span><strong>Transa√ß√µes:</strong></span>
                        <span class="value" id="maio-transactions">-</span>
                    </div>
                    <div class="metric">
                        <span><strong>Total USD:</strong></span>
                        <span class="value" id="maio-usd">-</span>
                    </div>
                    <div class="metric">
                        <span><strong>Total BRL:</strong></span>
                        <span class="value" id="maio-brl">-</span>
                    </div>
                </div>

                <div class="card">
                    <h3>üìÖ Julho 2025</h3>
                    <div class="metric">
                        <span><strong>Transa√ß√µes:</strong></span>
                        <span class="value" id="julho-transactions">-</span>
                    </div>
                    <div class="metric">
                        <span><strong>Total USD:</strong></span>
                        <span class="value" id="julho-usd">-</span>
                    </div>
                    <div class="metric">
                        <span><strong>Total BRL:</strong></span>
                        <span class="value" id="julho-brl">-</span>
                    </div>
                </div>

                <div class="card">
                    <h3>üìà Comparativo</h3>
                    <div class="metric">
                        <span><strong>Varia√ß√£o Transa√ß√µes:</strong></span>
                        <span class="value" id="var-transactions">-</span>
                    </div>
                    <div class="metric">
                        <span><strong>Varia√ß√£o USD:</strong></span>
                        <span class="value" id="var-usd">-</span>
                    </div>
                    <div class="metric">
                        <span><strong>Varia√ß√£o BRL:</strong></span>
                        <span class="value" id="var-brl">-</span>
                    </div>
                </div>
            </div>

            <div class="charts-container">
                <div class="chart-card">
                    <h3>üí∞ Gastos por M√™s (BRL)</h3>
                    <div class="chart-container">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>üè∑Ô∏è Gastos por Categoria</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>üìä Comparativo USD vs BRL</h3>
                    <div class="chart-container">
                        <canvas id="currencyChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>üìà Distribui√ß√£o de Transa√ß√µes</h3>
                    <div class="chart-container">
                        <canvas id="transactionChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="filter-controls">
                <div class="filter-group">
                    <label><strong>Filtrar por:</strong></label>
                    <select id="monthFilter">
                        <option value="all">Todos os Meses</option>
                        <option value="Maio 2025">Maio 2025</option>
                        <option value="Julho 2025">Julho 2025</option>
                    </select>
                    <select id="categoryFilter">
                        <option value="all">Todas as Categorias</option>
                    </select>
                    <input type="text" id="searchFilter" placeholder="Buscar por movimenta√ß√£o...">
                </div>
            </div>

            <div class="transactions-table">
                <h3>üìã Detalhamento Completo das Transa√ß√µes</h3>
                <div class="table-container">
                    <table id="transactionsTable">
                        <thead>
                            <tr>
                                <th>M√™s</th>
                                <th>Profissional</th>
                                <th>Data</th>
                                <th>Movimenta√ß√£o</th>
                                <th>Categoria</th>
                                <th>Valor USD</th>
                                <th>Valor BRL</th>
                                <th>Relat√≥rio</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let data = null;
        let filteredData = [];
        let charts = {};
        let maioFile = null;
        let julhoFile = null;

        // Event listeners para upload de arquivos
        document.getElementById('maioFile').addEventListener('change', function(e) {
            maioFile = e.target.files[0];
            checkFilesReady();
        });

        document.getElementById('julhoFile').addEventListener('change', function(e) {
            julhoFile = e.target.files[0];
            checkFilesReady();
        });

        document.getElementById('processBtn').addEventListener('click', processFiles);

        function checkFilesReady() {
            const processBtn = document.getElementById('processBtn');
            processBtn.disabled = !(maioFile && julhoFile);
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }

        async function processFiles() {
            try {
                showStatus('üîÑ Processando arquivos...', 'loading');
                
                const maioData = await processExcelFile(maioFile, 'Maio 2025');
                const julhoData = await processExcelFile(julhoFile, 'Julho 2025');
                
                const maioCategories = categorizeData(maioData.transactions);
                const julhoCategories = categorizeData(julhoData.transactions);
                
                data = {
                    totalsMaio: maioData.totals,
                    totalsJulho: julhoData.totals,
                    allTransactions: [...maioData.transactions, ...julhoData.transactions],
                    categorizedData: {
                        maio: maioCategories,
                        julho: julhoCategories
                    }
                };
                
                showStatus('‚úÖ Arquivos processados com sucesso!', 'success');
                document.getElementById('dashboardContent').classList.remove('hidden');
                initializeDashboard();
                
            } catch (error) {
                console.error('Erro ao processar arquivos:', error);
                showStatus(`‚ùå Erro ao processar arquivos: ${error.message}`, 'error');
            }
        }

        function processExcelFile(file, monthName) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const workbook = XLSX.read(e.target.result, { type: 'binary' });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                        
                        // Os headers est√£o na linha 2 (√≠ndice 2)
                        const headers = data[2];
                        
                        // Os dados come√ßam na linha 3 (√≠ndice 3)
                        const transactions = [];
                        let totalUSD = 0;
                        let totalBRL = 0;
                        
                        for (let i = 3; i < data.length; i++) {
                            const row = data[i];
                            if (!row || row.length === 0 || !row[0]) continue;
                            
                            const transaction = {
                                profissional: row[0],
                                data: row[1],
                                movimentacao: row[2],
                                valorUSD: row[3] || 0,
                                valorBRL: row[4] || 0,
                                relatorio: row[5] || '',
                                status: row[6] || '',
                                nfInvoice: row[7] || '',
                                mes: monthName
                            };
                            
                            transactions.push(transaction);
                            totalUSD += parseFloat(transaction.valorUSD) || 0;
                            totalBRL += parseFloat(transaction.valorBRL) || 0;
                        }
                        
                        resolve({
                            transactions,
                            totals: {
                                transacoes: transactions.length,
                                usd: totalUSD,
                                brl: totalBRL
                            }
                        });
                        
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = reject;
                reader.readAsBinaryString(file);
            });
        }

        function categorizeTransaction(movimentacao) {
            const mov = movimentacao.toUpperCase();
            if (mov.includes('OPENAI') || mov.includes('ANTHROPIC') || mov.includes('CLAUDE')) return 'AI/ML';
            if (mov.includes('MERCADOLIVRE') || mov.includes('MERCADOLIV')) return 'E-commerce';
            if (mov.includes('KABUM') || mov.includes('HUB*KABUM')) return 'Hardware';
            if (mov.includes('MIRO') || mov.includes('BOLT') || mov.includes('STACKBLITZ') || mov.includes('VUE')) return 'Dev Tools';
            if (mov.includes('CHECKR') || mov.includes('ABACUS')) return 'SaaS/Tools';
            if (mov.includes('GITHUB') || mov.includes('GIT')) return 'Code/Git';
            if (mov.includes('DIGITAL OCEAN') || mov.includes('DIGITALOCEAN')) return 'Cloud/Hosting';
            if (mov.includes('REGISTROBR') || mov.includes('ONLYDOMAINS')) return 'Dom√≠nios';
            if (mov.includes('AWS') || mov.includes('AMAZON')) return 'Cloud/AWS';
            return 'Outros';
        }

        function categorizeData(transactions) {
            const categorized = {};
            
            transactions.forEach(transaction => {
                const category = categorizeTransaction(transaction.movimentacao);
                
                if (!categorized[category]) {
                    categorized[category] = {
                        usd: 0,
                        brl: 0,
                        transacoes: 0
                    };
                }
                
                categorized[category].usd += parseFloat(transaction.valorUSD) || 0;
                categorized[category].brl += parseFloat(transaction.valorBRL) || 0;
                categorized[category].transacoes += 1;
            });
            
            return categorized;
        }

        function formatCurrency(value, currency = 'BRL') {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: currency
            }).format(value);
        }

        function initializeDashboard() {
            updateSummaryCards();
            createCharts();
            populateFilters();
            populateTransactionsTable();
        }

        function updateSummaryCards() {
            const totalTransactions = data.totalsMaio.transacoes + data.totalsJulho.transacoes;
            const totalUSD = data.totalsMaio.usd + data.totalsJulho.usd;
            const totalBRL = data.totalsMaio.brl + data.totalsJulho.brl;
            const avgTicket = totalBRL / totalTransactions;

            // Totais gerais
            document.getElementById('total-transactions').textContent = totalTransactions;
            document.getElementById('total-usd').textContent = formatCurrency(totalUSD, 'USD');
            document.getElementById('total-brl').textContent = formatCurrency(totalBRL);
            document.getElementById('avg-ticket').textContent = formatCurrency(avgTicket);

            // Maio
            document.getElementById('maio-transactions').textContent = data.totalsMaio.transacoes;
            document.getElementById('maio-usd').textContent = formatCurrency(data.totalsMaio.usd, 'USD');
            document.getElementById('maio-brl').textContent = formatCurrency(data.totalsMaio.brl);

            // Julho
            document.getElementById('julho-transactions').textContent = data.totalsJulho.transacoes;
            document.getElementById('julho-usd').textContent = formatCurrency(data.totalsJulho.usd, 'USD');
            document.getElementById('julho-brl').textContent = formatCurrency(data.totalsJulho.brl);

            // Varia√ß√µes
            const varTransactions = ((data.totalsJulho.transacoes - data.totalsMaio.transacoes) / data.totalsMaio.transacoes * 100).toFixed(1);
            const varUSD = ((data.totalsJulho.usd - data.totalsMaio.usd) / data.totalsMaio.usd * 100).toFixed(1);
            const varBRL = ((data.totalsJulho.brl - data.totalsMaio.brl) / data.totalsMaio.brl * 100).toFixed(1);

            document.getElementById('var-transactions').textContent = `${varTransactions > 0 ? '+' : ''}${varTransactions}%`;
            document.getElementById('var-usd').textContent = `${varUSD > 0 ? '+' : ''}${varUSD}%`;
            document.getElementById('var-brl').textContent = `${varBRL > 0 ? '+' : ''}${varBRL}%`;
        }

        function createCharts() {
            createMonthlyChart();
            createCategoryChart();
            createCurrencyChart();
            createTransactionChart();
        }

        function createMonthlyChart() {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            if (charts.monthly) charts.monthly.destroy();
            
            charts.monthly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Maio 2025', 'Julho 2025'],
                    datasets: [{
                        label: 'Gastos em BRL',
                        data: [data.totalsMaio.brl, data.totalsJulho.brl],
                        backgroundColor: ['#3498db', '#e74c3c'],
                        borderColor: ['#2980b9', '#c0392b'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function createCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            if (charts.category) charts.category.destroy();
            
            const allCategories = new Set();
            Object.keys(data.categorizedData.maio || {}).forEach(cat => allCategories.add(cat));
            Object.keys(data.categorizedData.julho || {}).forEach(cat => allCategories.add(cat));
            
            const categories = Array.from(allCategories);

            charts.category = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{
                        data: categories.map(cat => {
                            const maio = (data.categorizedData.maio[cat] || {brl: 0}).brl;
                            const julho = (data.categorizedData.julho[cat] || {brl: 0}).brl;
                            return maio + julho;
                        }),
                        backgroundColor: [
                            '#3498db', '#e74c3c', '#f39c12', '#27ae60', 
                            '#9b59b6', '#1abc9c', '#34495e', '#e67e22',
                            '#f1c40f', '#e91e63'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createCurrencyChart() {
            const ctx = document.getElementById('currencyChart').getContext('2d');
            if (charts.currency) charts.currency.destroy();
            
            charts.currency = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Maio 2025', 'Julho 2025'],
                    datasets: [{
                        label: 'USD',
                        data: [data.totalsMaio.usd, data.totalsJulho.usd],
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'BRL',
                        data: [data.totalsMaio.brl, data.totalsJulho.brl],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createTransactionChart() {
            const ctx = document.getElementById('transactionChart').getContext('2d');
            if (charts.transaction) charts.transaction.destroy();
            
            charts.transaction = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Maio 2025', 'Julho 2025'],
                    datasets: [{
                        label: 'N√∫mero de Transa√ß√µes',
                        data: [data.totalsMaio.transacoes, data.totalsJulho.transacoes],
                        backgroundColor: ['#9b59b6', '#f39c12'],
                        borderColor: ['#8e44ad', '#e67e22'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function populateFilters() {
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<option value="all">Todas as Categorias</option>';
            
            const allCategories = new Set();
            Object.keys(data.categorizedData.maio || {}).forEach(cat => allCategories.add(cat));
            Object.keys(data.categorizedData.julho || {}).forEach(cat => allCategories.add(cat));
            
            Array.from(allCategories).forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });

            // Event listeners para filtros
            document.getElementById('monthFilter').addEventListener('change', filterTransactions);
            document.getElementById('categoryFilter').addEventListener('change', filterTransactions);
            document.getElementById('searchFilter').addEventListener('input', filterTransactions);
        }

        function populateTransactionsTable() {
            filteredData = [...(data.allTransactions || [])];
            renderTransactionsTable();
        }

        function renderTransactionsTable() {
            const tbody = document.getElementById('transactionsBody');
            tbody.innerHTML = '';

            filteredData.forEach(transaction => {
                const row = document.createElement('tr');
                const category = categorizeTransaction(transaction.movimentacao);
                
                row.innerHTML = `
                    <td>${transaction.mes}</td>
                    <td>${transaction.profissional}</td>
                    <td>${transaction.data}</td>
                    <td>${transaction.movimentacao}</td>
                    <td><span style="background: #3498db; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8em;">${category}</span></td>
                    <td>${transaction.valorUSD ? formatCurrency(transaction.valorUSD, 'USD') : '-'}</td>
                    <td>${transaction.valorBRL ? formatCurrency(transaction.valorBRL) : '-'}</td>
                    <td>${transaction.relatorio || '-'}</td>
                    <td>${transaction.status || '-'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterTransactions() {
            const monthFilter = document.getElementById('monthFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const searchFilter = document.getElementById('searchFilter').value.toLowerCase();

            filteredData = (data.allTransactions || []).filter(transaction => {
                const matchMonth = monthFilter === 'all' || transaction.mes === monthFilter;
                const matchCategory = categoryFilter === 'all' || categorizeTransaction(transaction.movimentacao) === categoryFilter;
                const matchSearch = transaction.movimentacao.toLowerCase().includes(searchFilter);
                
                return matchMonth && matchCategory && matchSearch;
            });

            renderTransactionsTable();
        }
    </script>
</body>
</html>
